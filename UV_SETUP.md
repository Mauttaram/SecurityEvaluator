# UV Setup Guide - SecurityEvaluator

Complete guide for setting up and using `uv` with the SecurityEvaluator project.

---

## ğŸ“¦ What is UV?

[uv](https://github.com/astral-sh/uv) is an extremely fast Python package installer and resolver, written in Rust. It's a drop-in replacement for pip and pip-tools that's 10-100x faster.

**Key Benefits:**
- âš¡ 10-100x faster than pip
- ğŸ”’ Reliable dependency resolution
- ğŸ“¦ Built-in virtual environment management
- ğŸ” Lock file support for reproducible builds
- ğŸš€ No need for separate virtualenv/venv commands

---

## ğŸš€ Installation

### macOS/Linux
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

### macOS (via Homebrew)
```bash
brew install uv
```

### Windows (PowerShell)
```powershell
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
```

### Verify Installation
```bash
uv --version
```

---

## ğŸ—ï¸ Project Setup

### 1. Initial Setup (First Time)

```bash
# Navigate to project directory
cd /path/to/SecurityEvaluator

# Sync dependencies from uv.lock (creates .venv automatically)
uv sync

# Verify installation
source .venv/bin/activate  # macOS/Linux
# OR
.venv\Scripts\activate     # Windows

python --version
python -c "import pydantic; print('Dependencies installed!')"
```

### 2. Quick Setup (If .venv exists)

```bash
# Just activate the virtual environment
source .venv/bin/activate  # macOS/Linux
# OR
.venv\Scripts\activate     # Windows
```

---

## ğŸ“‹ Common UV Commands

### Install Dependencies

```bash
# Install all dependencies from pyproject.toml
uv sync

# Install only production dependencies (no dev)
uv sync --no-dev

# Install specific package
uv add httpx

# Install dev dependency
uv add --dev pytest
```

### Manage Packages

```bash
# Add a new dependency
uv add package-name

# Add with version constraint
uv add "pydantic>=2.0.0"

# Remove a dependency
uv remove package-name

# Update all dependencies
uv sync --upgrade

# Update specific package
uv add --upgrade package-name
```

### Virtual Environment

```bash
# Create virtual environment (done automatically by uv sync)
uv venv

# Create with specific Python version
uv venv --python 3.11

# Activate
source .venv/bin/activate  # macOS/Linux
.venv\Scripts\activate     # Windows

# Deactivate
deactivate
```

### Run Commands

```bash
# Run Python script with uv (auto-activates venv)
uv run python script.py

# Run any command in the venv
uv run pytest
uv run python purple_agents/home_automation_agent.py

# Run with specific Python version
uv run --python 3.11 python script.py
```

---

## ğŸ§ª Running Tests with UV

### Option 1: Using the Test Script (Recommended)

The `run_tests.sh` script automatically detects and uses the uv-managed virtual environment:

```bash
./tests/run_tests.sh
```

### Option 2: Manual with UV Run

```bash
# Start Purple Agent
uv run python purple_agents/home_automation_agent.py --port 8000

# In another terminal, run tests
uv run python tests/test_final_comprehensive.py
```

### Option 3: Activate and Run

```bash
# Activate virtual environment
source .venv/bin/activate

# Start Purple Agent
python purple_agents/home_automation_agent.py --port 8000

# In another terminal (after activating venv), run tests
python tests/test_final_comprehensive.py
```

---

## ğŸ“ Project Files

### pyproject.toml
This file defines your project dependencies and configuration:

```toml
[project]
name = "security_evaluator"
version = "0.1.0"
requires-python = ">=3.11"
dependencies = [
    "a2a-sdk>=0.3.5",
    "pydantic>=2.11.9",
    # ... other dependencies
]

[tool.uv]
dev-dependencies = [
    "mypy>=1.18.1",
    "pytest>=7.4.0",
]
```

### uv.lock
This file locks exact versions of all dependencies (including transitive deps) for reproducible installations. **Don't edit this manually** - it's auto-generated by `uv sync`.

---

## ğŸ”§ Troubleshooting

### Problem: "uv: command not found"

**Solution:** Install uv following the installation steps above.

### Problem: "No virtual environment found"

**Solution:** Run `uv sync` to create .venv and install dependencies.

### Problem: "Module not found" when running scripts

**Solutions:**
1. Use `uv run python script.py` (auto-activates venv)
2. OR activate venv first: `source .venv/bin/activate`
3. OR run `uv sync` to ensure all deps are installed

### Problem: Dependencies out of sync

**Solution:**
```bash
# Re-sync from lock file
uv sync

# If lock file is outdated, regenerate it
rm uv.lock
uv sync
```

### Problem: Python version mismatch

**Solution:**
```bash
# Check required version in pyproject.toml (requires-python = ">=3.11")
python --version

# Create venv with specific Python
uv venv --python 3.11
uv sync
```

---

## ğŸ†š UV vs PIP Comparison

| Task | pip | uv |
|------|-----|-----|
| Install deps | `pip install -r requirements.txt` | `uv sync` |
| Add package | `pip install package` + manual edit | `uv add package` |
| Update package | `pip install --upgrade package` | `uv add --upgrade package` |
| Create venv | `python -m venv .venv` | `uv venv` (or auto with sync) |
| Lock deps | `pip freeze > requirements.txt` | `uv lock` (automatic) |
| Speed | ğŸŒ Slow | âš¡ 10-100x faster |

---

## ğŸ’¡ Best Practices

### âœ… DO

1. **Use `uv sync`** instead of `pip install -r requirements.txt`
2. **Use `uv add`** to add new dependencies (auto-updates pyproject.toml and uv.lock)
3. **Commit both** `pyproject.toml` and `uv.lock` to version control
4. **Use `uv run`** for quick one-off commands without activating venv
5. **Run `uv sync`** after pulling changes from git

### âŒ DON'T

1. **Don't use pip** inside uv-managed projects (use uv commands instead)
2. **Don't manually edit** `uv.lock` (it's auto-generated)
3. **Don't commit** `.venv` directory (it's in .gitignore)
4. **Don't use** `requirements.txt` (uv uses pyproject.toml)

---

## ğŸ”„ Migration from PIP

If you previously used pip and want to switch to uv:

```bash
# 1. Install uv (see Installation section)

# 2. Remove old virtual environment
rm -rf venv/ env/ .venv/

# 3. Install dependencies with uv
uv sync

# 4. Test that everything works
source .venv/bin/activate
python -c "import pydantic; print('Success!')"

# 5. (Optional) Remove old pip files
# Note: Keep requirements.txt if other tools need it
```

---

## ğŸ“š Additional Resources

- **UV Documentation:** https://docs.astral.sh/uv/
- **GitHub Repository:** https://github.com/astral-sh/uv
- **Project Guide:** See main [README.md](README.md)
- **A2A Protocol:** See [docs/AGENTCARD_EXPLAINED.md](docs/AGENTCARD_EXPLAINED.md)

---

## ğŸ¯ Quick Reference

```bash
# First time setup
uv sync

# Activate virtual environment
source .venv/bin/activate

# Run tests (easiest)
./tests/run_tests.sh

# Run tests (with uv)
uv run python tests/test_final_comprehensive.py

# Add new package
uv add package-name

# Update dependencies
uv sync --upgrade

# Check what's installed
uv pip list
```

---

**Created:** November 2025
**Project:** SecurityEvaluator
**Tool:** uv 0.5+
